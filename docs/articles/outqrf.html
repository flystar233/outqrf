<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Using outqrf • outqrf</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Using outqrf">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">outqrf</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/outqrf.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/flystar233/outqrf/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Using outqrf</h1>
                        <h4 data-toc-skip class="author">lucian xu</h4>
            
            <h4 data-toc-skip class="date">2024-09-05</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/flystar233/outqrf/blob/HEAD/vignettes/outqrf.Rmd" class="external-link"><code>vignettes/outqrf.Rmd</code></a></small>
      <div class="d-none name"><code>outqrf.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>{outqrf} is an R package used for outlier detection. Each numeric
variable is regressed onto all other variables using a quantile random
forest <span class="citation">(<a href="#ref-Meinshausen">Meinshausen
2006</a>)</span>. We use {ranger} package <span class="citation">(<a href="#ref-wright">Wright and Ziegler 2017</a>)</span> to perform the
fitting and prediction of quantile regression forests. Next, we will
compute the rank of the observed values in the predicted results’
quantiles. If the rank of the observed value exceeds the threshold, the
observed value is considered an outlier.</p>
<p>Since the same predicted value might be distributed across multiple
quantiles in the predicted quantile results, this affects our location
finding for the observed value. Therefore, we also used a method similar
to the outForest package to compare the observed value with the 50%
quantile value again to determine the final quantile result.</p>
</div>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Development version</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"flystar233/outqrf"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="usage">Usage<a class="anchor" aria-label="anchor" href="#usage"></a>
</h2>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/flystar233/outqrf" class="external-link">outqrf</a></span><span class="op">)</span></span>
<span><span class="co">#Generate data with outliers in numeric columns</span></span>
<span><span class="va">irisWithOutliers</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generateOutliers.html">generateOutliers</a></span><span class="op">(</span><span class="va">iris</span>, p <span class="op">=</span> <span class="fl">0.05</span>,seed <span class="op">=</span><span class="fl">2024</span><span class="op">)</span></span>
<span><span class="co"># Find outliers by quantile random forest regressions</span></span>
<span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/outqrf.html">outqrf</a></span><span class="op">(</span><span class="va">irisWithOutliers</span>,quantiles_type<span class="op">=</span><span class="fl">400</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Outlier identification by quantiles random forests</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   Variables to check:        Sepal.Length, Sepal.Width, Petal.Length, Petal.Width</span></span>
<span><span class="co">#&gt;   Variables used to check:   Sepal.Length, Sepal.Width, Petal.Length, Petal.Width, Species</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   Checking: Sepal.Length  Sepal.Width  Petal.Length  Petal.Width</span></span>
<span><span class="va">out</span><span class="op">$</span><span class="va">outliers</span></span>
<span><span class="co">#&gt;    row          col observed predicted   rank</span></span>
<span><span class="co">#&gt; 1   32 Sepal.Length     14.9      5.40 0.9975</span></span>
<span><span class="co">#&gt; 2   35 Sepal.Length     -1.8      4.60 0.0025</span></span>
<span><span class="co">#&gt; 3   84 Sepal.Length     11.5      6.80 0.9975</span></span>
<span><span class="co">#&gt; 4  129 Sepal.Length     -5.6      6.30 0.0025</span></span>
<span><span class="co">#&gt; 5   49  Sepal.Width     10.8      3.85 0.9975</span></span>
<span><span class="co">#&gt; 6  131  Sepal.Width     -2.1      2.70 0.0025</span></span>
<span><span class="co">#&gt; 7  137  Sepal.Width     11.5      3.20 0.9975</span></span>
<span><span class="co">#&gt; 8   36 Petal.Length     12.8      1.60 0.9975</span></span>
<span><span class="co">#&gt; 9   73 Petal.Length    -17.2      4.40 0.0025</span></span>
<span><span class="co">#&gt; 10 107 Petal.Length     13.7      5.60 0.9975</span></span>
<span><span class="co">#&gt; 11 123 Petal.Length     -9.0      5.20 0.0025</span></span>
<span><span class="co">#&gt; 12 140 Petal.Length     13.5      5.80 0.9975</span></span>
<span><span class="co">#&gt; 13  10  Petal.Width    -11.8      0.20 0.0025</span></span>
<span><span class="co">#&gt; 14  14  Petal.Width     -6.3      0.20 0.0025</span></span>
<span><span class="co">#&gt; 15  34  Petal.Width      7.6      0.40 0.9975</span></span>
<span><span class="co">#&gt; 16  66  Petal.Width      7.0      2.00 0.9950</span></span>
<span><span class="co">#&gt; 17 113  Petal.Width     -6.1      1.80 0.0025</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="evaluation-on-diamonds-small-dataset">Evaluation on diamonds (Small Dataset)<a class="anchor" aria-label="anchor" href="#evaluation-on-diamonds-small-dataset"></a>
</h2>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/flystar233/outqrf" class="external-link">outqrf</a></span><span class="op">)</span></span>
<span><span class="va">irisWithOutliers</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generateOutliers.html">generateOutliers</a></span><span class="op">(</span><span class="va">iris</span>, p <span class="op">=</span> <span class="fl">0.05</span>,seed <span class="op">=</span><span class="fl">2024</span><span class="op">)</span></span>
<span><span class="va">qrf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/outqrf.html">outqrf</a></span><span class="op">(</span><span class="va">irisWithOutliers</span>,quantiles_type<span class="op">=</span><span class="fl">400</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Outlier identification by quantiles random forests</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   Variables to check:        Sepal.Length, Sepal.Width, Petal.Length, Petal.Width</span></span>
<span><span class="co">#&gt;   Variables used to check:   Sepal.Length, Sepal.Width, Petal.Length, Petal.Width, Species</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   Checking: Sepal.Length  Sepal.Width  Petal.Length  Petal.Width</span></span>
<span></span>
<span><span class="fu"><a href="../reference/evaluateOutliers.html">evaluateOutliers</a></span><span class="op">(</span><span class="va">iris</span>,<span class="va">irisWithOutliers</span>,<span class="va">qrf</span><span class="op">$</span><span class="va">outliers</span><span class="op">)</span></span>
<span><span class="co">#&gt;     Actual  Predicted      Cover   Coverage Efficiency </span></span>
<span><span class="co">#&gt;      32.00      17.00      17.00       0.53       1.00</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">qrf</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Outlier identification by quantiles random forests</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   Variables to check:        Sepal.Length, Sepal.Width, Petal.Length, Petal.Width</span></span>
<span><span class="co">#&gt;   Variables used to check:   Sepal.Length, Sepal.Width, Petal.Length, Petal.Width, Species</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   Checking: Sepal.Length  Sepal.Width  Petal.Length  Petal.Width</span></span></code></pre>
<p><img src="outqrf_files/figure-html/Evaluation1_2-1.png" width="576" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 id="evaluation-on-diamonds-big-dataset">Evaluation on diamonds (Big Dataset)<a class="anchor" aria-label="anchor" href="#evaluation-on-diamonds-big-dataset"></a>
</h2>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/flystar233/outqrf" class="external-link">outqrf</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="va">diamonds</span><span class="op">|&gt;</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">price</span>,<span class="va">carat</span>,<span class="va">cut</span>,<span class="va">color</span>,<span class="va">clarity</span><span class="op">)</span></span>
<span><span class="va">data2</span> <span class="op">&lt;-</span> <span class="fu">outqrf</span><span class="fu">::</span><span class="fu"><a href="../reference/generateOutliers.html">generateOutliers</a></span><span class="op">(</span><span class="va">data</span>, p <span class="op">=</span> <span class="fl">0.001</span>,seed <span class="op">=</span><span class="fl">2024</span><span class="op">)</span></span>
<span><span class="co"># 108</span></span>
<span><span class="va">qrf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/outqrf.html">outqrf</a></span><span class="op">(</span><span class="va">data2</span>,num.threads<span class="op">=</span><span class="fl">8</span>,quantiles_type<span class="op">=</span><span class="fl">400</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Outlier identification by quantiles random forests</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   Variables to check:        price, carat</span></span>
<span><span class="co">#&gt;   Variables used to check:   price, carat, cut, color, clarity</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   Checking: price  carat</span></span>
<span><span class="co">#The process can be slow because it needs to predict the value at 400|1000 quantiles for each observation. </span></span>
<span><span class="fu"><a href="../reference/evaluateOutliers.html">evaluateOutliers</a></span><span class="op">(</span><span class="va">data</span>,<span class="va">data2</span>,<span class="va">qrf</span><span class="op">$</span><span class="va">outliers</span><span class="op">)</span></span>
<span><span class="co">#&gt;     Actual  Predicted      Cover   Coverage Efficiency </span></span>
<span><span class="co">#&gt;     108.00     369.00     103.00       0.95       0.28</span></span></code></pre></div>
</div>
<div class="section level2 unnumbered">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-Meinshausen" class="csl-entry">
Meinshausen, Nicolai. 2006. <span>“Quantile Regression Forests.”</span>
<em>J. Mach. Learn. Res.</em> 7 (17): 983–99. <a href="https://dl.acm.org/doi/10.5555/1248547.1248582" class="external-link">https://dl.acm.org/doi/10.5555/1248547.1248582</a>.
</div>
<div id="ref-wright" class="csl-entry">
Wright, Marvin, and Andreas Ziegler. 2017. <span>“Ranger: A Fast
Implementation of Random Forests for High Dimensional Data in c++ and
r.”</span> <em>Journal of Statistical Software, Articles</em> 77 (1):
1–17. <a href="https://doi.org/10.18637/jss.v077.i01" class="external-link">https://doi.org/10.18637/jss.v077.i01</a>.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Tengfei Xu.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
